{
    "typeName": "AWS::EC2::NetworkInsightsAnalysis",
    "description": "Resource schema for AWS::EC2::NetworkInsightsAnalysis",
    "sourceUrl": "https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-ec2-ni.git",
    "definitions": {
        "Tags": {
            "type": "array",
            "description": "An array of key-value pairs to apply to this resource",
            "minItems": 1,
            "maxItems": 20,
            "uniqueItems": true,
            "items": {
                "$ref": "#/definitions/Tag"
            }
        },
        "Tag": {
            "description": "A key-value pair to associate with a resource",
            "type": "object",
            "properties": {
                "Key": {
                    "type": "string",
                    "description": "The key name of the tag. You can specify a value that is 1 to 128 Unicode characters in length and cannot be prefixed with aws:. You can use any of the following characters: the set of Unicode letters, digits, whitespace, _, ., /, =, +, and -. ",
                    "minLength": 1,
                    "maxLength": 128,
                    "pattern": "^(?!aws:.*)[a-z0-9\\s\\_\\.\\/\\=\\+\\-]+$"
                },
                "Value": {
                    "type": "string",
                    "description": "The value for the tag. You can specify a value that is 1 to 255 Unicode characters in length and cannot be prefixed with aws:. You can use any of the following characters: the set of Unicode letters, digits, whitespace, _, ., /, =, +, and -. ",
                    "minLength": 1,
                    "maxLength": 255,
                    "pattern": "^(?!aws:.*)[a-z0-9\\s\\_\\.\\/\\=\\+\\-]+$"
                }
            },
            "required": [
                "Key"
            ]
        },
        "ResourceArn": {
            "type": "string",
            "minLength": 1,
            "maxLength": 1283
        },
        "PortRange": {
            "type": "object",
            "properties": {
                "From": {
                    "type": "integer",
                    "description": "From port of the port range"
                },
                "To": {
                    "type": "integer",
                    "description": "To port of the port range"
                }
            }
        },
        "Protocol": {
            "type": "string",
            "enum": [
                "TCP",
                "UDP",
                "ALL"
            ]
        },
        "AclRule" : {
            "description": "Represents an AclRule",
            "type": "object",
            "properties": {
                "Cidr": {
                    "type": "string",
                    "description": "Cidr of the AclRule"
                },
                "Egress": {
                    "type": "boolean",
                    "description": "Represents if AclRule applies to egress traffic or not"
                },
                "PortRange": {
                    "$ref": "#/definitions/PortRange",
                    "description": "Represents port range of the AclRule"
                },
                "Protocol": {
                    "$ref": "#/definitions/Protocol",
                    "description": "Represents protocol of the AclRule"
                },
                "RuleAction": {
                    "type": "string",
                    "description": "Represents rule action of the AclRule"
                },
                "RuleNumber": {
                    "type": "integer",
                    "description": "Represents rule number of the AclRule"
                }
            }
        },
        "Header" : {
            "type": "object",
            "properties": {
                "DestinationAddresses": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/IpAddress"
                    }
                },
                "DestinationPortRanges": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PortRange"
                    }
                },
                "Protocol": {
                    "$ref": "#/definitions/Protocol"
                },
                "SourceAddresses": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/IpAddress"
                    }
                },
                "SourcePortRanges": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PortRange"
                    }
                }
            }
        },
        "PathComponent": {
            "description": "Component that is a part of the path between the source and destination",
            "type": "object",
            "properties": {
                "AclRule": {
                    "$ref": "#/definitions/AclRule",
                    "description": "Represents an AclRule"
                },
                "Component": {
                    "$ref": "#/definitions/Component",
                    "description": "Identifier for the analysis"
                },
                "DestinationVpc": {
                    "$ref": "#/definitions/Component",
                    "description": "Identifier for the analysis"
                },
                "OutboundHeader": {
                    "$ref": "#/definitions/Header",
                    "description": "Identifier for the analysis"
                },
                "InboundHeader": {
                    "$ref": "#/definitions/Header",
                    "description": "Identifier for the analysis"
                },
                "RouteTableRoute": {
                    "$ref": "#/definitions/RouteTableRoute",
                    "description": "Identifier for the analysis"
                },
                "SecurityGroupRule": {
                    "$ref": "#/definitions/SecurityGroupRule",
                    "description": "Identifier for the analysis"
                },
                "SourceVpc": {
                    "$ref": "#/definitions/Component",
                    "description": "Identifier for the analysis"
                },
                "Subnet": {
                    "$ref": "#/definitions/Component",
                    "description": "Identifier for the analysis"
                },
                "Vpc": {
                    "$ref": "#/definitions/Component",
                    "description": "Identifier for the analysis"
                }
            }
        },
        "Component" : {
            "description": "A component has an identifier and an arn",
            "type": "object",
            "properties": {
                "Id": {
                    "type": "string",
                    "description": "Identifier of the component"
                },
                "Arn": {
                    "type": "string",
                    "description": "Arn of the component"
                }
            }
        },
        "IpAddress": {
            "type": "string",
            "description": "Represents an Ip Address",
            "pattern": "^([0-9]{1,3}.){3}[0-9]{1,3}$",
            "maxLength": 15
        },
        "LoadBalancerListener": {
            "type": "object",
            "description": "Represents a LoadBalancer listener",
            "properties": {
                "InstancePort": {
                    "$ref": "#/definitions/Port",
                    "description": "Represents the instance port of the LoadBalancer listener"
                },
                "LoadBalancerPort": {
                    "$ref": "#/definitions/Port",
                    "description": "Represents the LoadBalancer port of the LoadBalancer listener"
                }
            }
        },
        "LoadBalancerTarget": {
            "type": "object",
            "description": "Represents a LoadBalancer target",
            "properties": {
                "Address": {
                    "$ref": "#/definitions/IpAddress",
                    "description": "Represents the IpAddress of the LoadBalancer target"
                },
                "AvailabilityZone": {
                    "type": "string",
                    "description": "Represents the availability zone of the LoadBalancer target"
                },
                "Instance": {
                    "$ref": "#/definitions/Component",
                    "description": "Represents the instance of the LoadBalancer target"
                },
                "Port": {
                    "$ref": "#/definitions/Port",
                    "description": "Represents the port of the LoadBalancer target"
                }
            }
        },
        "Port": {
            "type": "integer",
            "minimum": 1,
            "maximum":65535,
            "description": "Represents a port number"
        },
        "RouteTableRoute": {
            "type": "object",
            "description": "Represents a route in a RouteTable",
            "properties": {
                "destinationCidr": {
                    "type": "string",
                    "description": "Represents the destination cidr of the route"
                },
                "destinationPrefixListId": {
                    "type": "string",
                    "description": "Represents the destination PrefixList identifier of the route"
                },
                "egressOnlyInternetGatewayId": {
                    "type": "string",
                    "description": "Represents the egress only InternetGateway identifier of the route"
                },
                "gatewayId": {
                    "type": "string",
                    "description": "Represents the Gateway identifier of the route"
                },
                "instanceId": {
                    "type": "string",
                    "description": "Represents the Instance identifier of the route"
                },
                "NatGatewayId": {
                    "type": "string",
                    "description": "Represents the NatGateway identifier of the route"
                },
                "NetworkInterfaceId": {
                    "type": "string",
                    "description": "Represents the NetworkInterface identifier of the route"
                },
                "Origin": {
                    "type": "string",
                    "description": "Represents the origin of the route"
                },
                "TransitGatewayId": {
                    "type": "string",
                    "description": "Represents the TransitGateway identifier of the route"
                },
                "VpcPeeringConnectionId": {
                    "type": "string",
                    "description": "Represents the VpcPeeringConnection identifier of the route"
                }
            }
        },
        "SecurityGroupRule": {
            "description": "Represents a SecurityGroup rule",
            "type": "object",
            "properties": {
                "Cidr": {
                    "type": "string",
                    "description": "Represents the cidr of the rule"
                },
                "Direction": {
                    "type": "string",
                    "description": "Represents the direction of the rule"
                },
                "SecurityGroupId": {
                    "type": "string",
                    "description": "Represents the SecurityGroup identifier of the rule"
                },
                "PortRange": {
                    "$ref": "#/definitions/PortRange",
                    "description": "Represents the PortRange of the rule"
                },
                "PrefixListId": {
                    "type": "string",
                    "description": "Represents the PrefixList identifier of the rule"
                },
                "Protocol": {
                    "$ref": "#/definitions/Protocol",
                    "description": "Represents the Protocol of the rule"
                }
            }
        },
        "Explanation": {
            "description": "Explanation of the analysis",
            "type": "object",
            "properties": {
                "Acl": {
                    "description": "Acl present in the explanation",
                    "$ref": "#/definitions/Component"
                },
                "AclRule": {
                    "description": "AclRule present in the explanation",
                    "$ref": "#/definitions/AclRule"
                },
                "Address": {
                    "description": "Ip Address present in the explanation",
                    "$ref": "#/definitions/IpAddress"
                },
                "Addresses": {
                    "description": "Ip Addresses present in the explanation",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/IpAddress"
                    }
                },
                "AttachedTo": {
                    "description": "Component that is attached to the path",
                    "$ref": "#/definitions/Component"
                },
                "AvailabilityZones": {
                    "description": "Availability zones related to the explanation",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "Cidrs": {
                    "description": "Cidr related to the explanation",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "Component": {
                    "description": "Component that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "CustomerGateway": {
                    "description": "CustomerGateway that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "Destination": {
                    "description": "Destination that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "DestinationVpc": {
                    "description": "Destination Vpc that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "Direction": {
                    "description": "Direction related to the explanation",
                    "type": "string"
                },
                "ExplanationCode": {
                    "description": "Explanation code that is part of the explanation",
                    "type": "string"
                },
                "IngressRouteTable": {
                    "description": "Ingress route table that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "InternetGateway": {
                    "description": "Internet gateway that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "LoadBalancerArn": {
                    "description": "Arn of the load balancer that is part of the explanation",
                    "$ref": "#/definitions/ResourceArn"
                },
                "ClassicLoadBalancerListener": {
                    "description": "Listener of classic load balancer that is part of the explanation",
                    "$ref": "#/definitions/LoadBalancerListener"
                },
                "LoadBalancerListenerPort": {
                    "description": "Listener port of load balancer that is part of the explanation",
                    "$ref": "#/definitions/Port"
                },
                "LoadBalancerTarget": {
                    "description": "Load balancer target that is part of the explanation",
                    "$ref": "#/definitions/LoadBalancerTarget"
                },
                "LoadBalancerTargetGroup": {
                    "description": "Load balancer target group that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "LoadBalancerTargetGroups": {
                    "description": "Load balancer target groups that are part of the explanation",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Component"
                    }
                },
                "LoadBalancerTargetPort": {
                    "description": "Target port of load balancer that is part of the explanation",
                    "$ref": "#/definitions/Port"
                },
                "ElasticLoadBalancerListener": {
                    "description": "Elastic load balancer listener that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "MissingComponent": {
                    "description": "missing component in the explanation",
                    "type": "string"
                },
                "NatGateway": {
                    "description": "NatGateway that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "NetworkInterface": {
                    "description": "Network interface that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "PacketField": {
                    "description": "Packet field that is part of the explanation",
                    "type": "string"
                },
                "VpcPeeringConnection": {
                    "description": "Vpc peering connection that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "Port": {
                    "description": "Port that is part of the explanation",
                    "$ref": "#/definitions/Port"
                },
                "PortRanges": {
                    "description": "Port ranges that are part of the explanation",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PortRange"
                    }
                },
                "PrefixList": {
                    "description": "PrefixList that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "Protocols": {
                    "description": "Protocols that are part of the explanation",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Protocol"
                    }
                },
                "RouteTableRoute": {
                    "description": "RouteTable route that is part of the explanation",
                    "$ref": "#/definitions/RouteTableRoute"
                },
                "RouteTable": {
                    "description": "RouteTable that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "SecurityGroup": {
                    "description": "SecurityGroup that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "SecurityGroupRule": {
                    "description": "SecurityGroup rule that is part of the explanation",
                    "$ref": "#/definitions/SecurityGroupRule"
                },
                "SecurityGroups": {
                    "description": "SecurityGroups that are part of the explanation",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Component"
                    }
                },
                "SourceVpc": {
                    "description": "Source Vpc that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "State": {
                    "description": "State that is part of the explanation",
                    "type": "string"
                },
                "Subnet": {
                    "description": "Subnet that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "SubnetRouteTable": {
                    "description": "Subnet routetable that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "Vpc": {
                    "description": "Vpc that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "vpcEndpoint": {
                    "description": "VpcEndpoint that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "VpnConnection": {
                    "description": "VpnConnection that is part of the explanation",
                    "$ref": "#/definitions/Component"
                },
                "VpnGateway": {
                    "description": "VpnGateway that is part of the explanation",
                    "$ref": "#/definitions/Component"
                }
            }
        },
        "AlternatePathHint": {
            "description": "Represents an alternative path hint",
            "type": "object",
            "properties": {
                "ComponentId": {
                    "description": "Component identifier of the component of the path",
                    "type": "string"
                },
                "ComponentArn": {
                    "description": "Component Arn of the component of the path",
                    "type": "string"
                }
            }
        }
    },
    "properties": {
        "NetworkInsightsAnalysisId": {
            "type": "string",
            "description": "Identifier for the analysis"
        },
        "NetworkInsightsAnalysisArn": {
            "type": "string",
            "description": "Arn for the analysis"
        },
        "StartDate": {
            "type": "string",
            "description": "Time at which the analysis started"
        },
        "Status": {
            "type": "string",
            "enum": [
                "running",
                "failed",
                "succeeded"
            ],
            "description": "Status of the analysis"
        },
        "ErrorCode": {
            "type": "integer",
            "description": "Error code returned by the analysis"
        },
        "ErrorMessage": {
            "type": "string",
            "description": "Error message returned by the analysis"
        },
        "NetworkPathFound": {
            "type": "boolean",
            "description": "True if a path is found, false otherwise"
        },
        "ForwardPathComponents": {
            "type": "array",
            "description": "Components involved in the path from source to destination",
            "items": {
                "$ref": "#/definitions/PathComponent"
            }
        },
        "ReturnPathComponents": {
            "type": "array",
            "description": "Components involved in the path from destination to source",
            "items": {
                "$ref": "#/definitions/PathComponent"
            }
        },
        "Explanations": {
            "type": "array",
            "description": "List of explanations",
            "items": {
                "$ref": "#/definitions/Explanation"
            }
        },
        "AlternatePathHints": {
            "type": "array",
            "description": "List of alternate path hints",
            "items": {
                "$ref": "#/definitions/AlternatePathHint"
            }
        },
        "NetworkInsightsPathId": {
            "description": "Identifier for the path",
            "type": "string",
            "pattern": "nip-.+"
        },
        "FilterInArns": {
            "type": "array",
            "description": "Arns to be included in the analysis response",
            "items": {
                "$ref": "#/definitions/ResourceArn"
            }
        },
        "Tags": {
            "type": "array",
            "description": "The tags for the analysis",
            "items": {
                "$ref": "#/definitions/Tag"
            }
        }
    },
    "additionalProperties": false,
    "required": [
        "NetworkInsightsPathId"
    ],
    "readOnlyProperties": [
        "/properties/NetworkInsightsAnalysisId",
        "/properties/NetworkInsightsAnalysisArn",
        "/properties/StartDate",
        "/properties/Status",
        "/properties/ErrorCode",
        "/properties/ErrorMessage",
        "/properties/NetworkPathFound",
        "/properties/ForwardPathComponents",
        "/properties/ReturnPathComponents",
        "/properties/Explanations",
        "/properties/AlternatePathHints"

    ],
    "primaryIdentifier": [
        "/properties/NetworkInsightsAnalysisId"
    ],
    "createOnlyProperties": [
        "/properties/NetworkInsightsPathId",
        "/properties/FilterInArns"
    ],
    "additionalIdentifiers": [
        [
            "/properties/NetworkInsightsAnalysisArn"
        ]
    ],
    "handlers": {
        "create": {
            "permissions": [
                "ec2:StartNetworkInsightsAnalysis",
                "ec2:GetTransitGatewayRouteTablePropagations",
                "ec2:DescribeTransitGatewayPeeringAttachments",
                "ec2:SearchTransitGatewayRoutes",
                "ec2:DescribeTransitGatewayRouteTables",
                "ec2:DescribeTransitGatewayVpcAttachments",
                "ec2:DescribeTransitGatewayAttachments",
                "ec2:DescribeTransitGateways",
                "ec2:GetManagedPrefixListEntries",
                "ec2:DescribeManagedPrefixLists",
                "ec2:DescribeAvailabilityZones",
                "ec2:DescribeCustomerGateways",
                "ec2:DescribeInstances",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeNatGateways",
                "ec2:DescribeNetworkAcls",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DescribePrefixLists",
                "ec2:DescribeRegions",
                "ec2:DescribeRouteTables",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeSubnets",
                "ec2:DescribeVpcEndpoints",
                "ec2:DescribeVpcPeeringConnections",
                "ec2:DescribeVpcs",
                "ec2:DescribeVpnConnections",
                "ec2:DescribeVpnGateways",
                "ec2:DescribeVpcEndpointServiceConfigurations",
                "elasticloadbalancing:DescribeListeners",
                "elasticloadbalancing:DescribeLoadBalancers",
                "elasticloadbalancing:DescribeLoadBalancerAttributes",
                "elasticloadbalancing:DescribeRules",
                "elasticloadbalancing:DescribeTags",
                "elasticloadbalancing:DescribeTargetGroups",
                "elasticloadbalancing:DescribeTargetHealth",
                "directconnect:DescribeConnections",
                "directconnect:DescribeDirectConnectGateways",
                "directconnect:DescribeDirectConnectGatewayAssociations",
                "directconnect:DescribeDirectConnectGatewayAttachments",
                "directconnect:DescribeVirtualGateways",
                "directconnect:DescribeVirtualInterfaces",
                "tiros:CreateQuery",
                "tiros:GetQueryAnswer",
                "tiros:GetQueryExplanation"
            ]
        },
        "delete": {
            "permissions": [
                "ec2:DeleteNetworkInsightsAnalysis"
            ]
        },
        "read": {
            "permissions": [
                "ec2:DescribeNetworkInsightsAnalyses"
            ]
        },
        "list": {
            "permissions": [
                "ec2:DescribeNetworkInsightsAnalyses"
            ]
        },
        "update": {
            "permissions": [
                "ec2:CreateTags",
                "ec2:DescribeNetworkInsightsAnalyses",
                "ec2:DeleteTags"
            ]
        }
    }
}