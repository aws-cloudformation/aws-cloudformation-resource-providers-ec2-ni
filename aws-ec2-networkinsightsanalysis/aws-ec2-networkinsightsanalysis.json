{
    "typeName": "AWS::EC2::NetworkInsightsAnalysis",
    "description": "Resource schema for AWS::EC2::NetworkInsightsAnalysis",
    "sourceUrl": "https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-ec2-ni.git",
    "definitions": {
        "Tags": {
            "type": "array",
            "minItems": 1,
            "maxItems": 20,
            "uniqueItems": true,
            "items": {
                "$ref": "#/definitions/Tag"
            }
        },
        "Tag": {
            "type": "object",
            "properties": {
                "Key": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 128,
                    "pattern": "^(?!aws:.*)[a-zA-Z0-9\\s\\_\\.\\/\\=\\+\\-]+$"
                },
                "Value": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255,
                    "pattern": "^(?!aws:.*)[a-zA-Z0-9\\s\\_\\.\\/\\=\\+\\-]+$"
                }
            },
            "required": [
                "Key"
            ]
        },
        "ResourceArn": {
            "type": "string",
            "minLength": 1,
            "maxLength": 1283
        },
        "PortRange": {
            "type": "object",
            "properties": {
                "From": {
                    "type": "integer"
                },
                "To": {
                    "type": "integer"
                }
            }
        },
        "Protocol": {
            "type": "string",
            "enum": [
                "TCP",
                "UDP",
                "ALL"
            ]
        },
        "AclRule" : {
            "type": "object",
            "properties": {
                "Cidr": {
                    "type": "string"
                },
                "Egress": {
                    "type": "boolean"
                },
                "PortRange": {
                    "$ref": "#/definitions/PortRange"
                },
                "Protocol": {
                    "$ref": "#/definitions/Protocol"
                },
                "RuleAction": {
                    "type": "string"
                },
                "RuleNumber": {
                    "type": "integer"
                }
            }
        },
        "Header" : {
            "type": "object",
            "properties": {
                "DestinationAddresses": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/IpAddress"
                    }
                },
                "DestinationPortRanges": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PortRange"
                    }
                },
                "Protocol": {
                    "$ref": "#/definitions/Protocol"
                },
                "SourceAddresses": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/IpAddress"
                    }
                },
                "SourcePortRanges": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PortRange"
                    }
                }
            }
        },
        "PathComponent": {
            "type": "object",
            "properties": {
                "AclRule": {
                    "$ref": "#/definitions/AclRule"
                },
                "Component": {
                    "$ref": "#/definitions/Component"
                },
                "DestinationVpc": {
                    "$ref": "#/definitions/Component"
                },
                "OutboundHeader": {
                    "$ref": "#/definitions/Header"
                },
                "InboundHeader": {
                    "$ref": "#/definitions/Header"
                },
                "RouteTableRoute": {
                    "$ref": "#/definitions/RouteTableRoute"
                },
                "SecurityGroupRule": {
                    "$ref": "#/definitions/SecurityGroupRule"
                },
                "SourceVpc": {
                    "$ref": "#/definitions/Component"
                },
                "Subnet": {
                    "$ref": "#/definitions/Component"
                },
                "Vpc": {
                    "$ref": "#/definitions/Component"
                }
            }
        },
        "Component" : {
            "type": "object",
            "properties": {
                "Id": {
                    "type": "string"
                },
                "Arn": {
                    "type": "string"
                }
            }
        },
        "IpAddress": {
            "type": "string",
            "pattern": "^([0-9]{1,3}.){3}[0-9]{1,3}$",
            "maxLength": 15
        },
        "LoadBalancerListener": {
            "type": "object",
            "properties": {
                "InstancePort": {
                    "$ref": "#/definitions/Port"
                },
                "LoadBalancerPort": {
                    "$ref": "#/definitions/Port"
                }
            }
        },
        "LoadBalancerTarget": {
            "type": "object",
            "properties": {
                "Address": {
                    "$ref": "#/definitions/IpAddress"
                },
                "AvailabilityZone": {
                    "type": "string"
                },
                "Instance": {
                    "$ref": "#/definitions/Component"
                },
                "Port": {
                    "$ref": "#/definitions/Port"
                }
            }
        },
        "Port": {
            "type": "integer",
            "minimum": 1,
            "maximum":65535
        },
        "RouteTableRoute": {
            "type": "object",
            "properties": {
                "destinationCidr": {
                    "type": "string"
                },
                "destinationPrefixListId": {
                    "type": "string"
                },
                "egressOnlyInternetGatewayId": {
                    "type": "string"
                },
                "gatewayId": {
                    "type": "string"
                },
                "instanceId": {
                    "type": "string"
                },
                "NatGatewayId": {
                    "type": "string"
                },
                "NetworkInterfaceId": {
                    "type": "string"
                },
                "Origin": {
                    "type": "string"
                },
                "TransitGatewayId": {
                    "type": "string"
                },
                "VpcPeeringConnectionId": {
                    "type": "string"
                }
            }
        },
        "SecurityGroupRule": {
            "type": "object",
            "properties": {
                "Cidr": {
                    "type": "string"
                },
                "Direction": {
                    "type": "string"
                },
                "SecurityGroupId": {
                    "type": "string"
                },
                "PortRange": {
                    "$ref": "#/definitions/PortRange"
                },
                "PrefixListId": {
                    "type": "string"
                },
                "Protocol": {
                    "$ref": "#/definitions/Protocol"
                }
            }
        },
        "Explanation": {
            "type": "object",
            "properties": {
                "Acl": {
                    "$ref": "#/definitions/Component"
                },
                "AclRule": {
                    "$ref": "#/definitions/AclRule"
                },
                "Address": {
                    "$ref": "#/definitions/IpAddress"
                },
                "Addresses": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/IpAddress"
                    }
                },
                "AttachedTo": {
                    "$ref": "#/definitions/Component"
                },
                "AvailabilityZones": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "Cidrs": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "Component": {
                    "$ref": "#/definitions/Component"
                },
                "CustomerGateway": {
                    "$ref": "#/definitions/Component"
                },
                "Destination": {
                    "$ref": "#/definitions/Component"
                },
                "DestinationVpc": {
                    "$ref": "#/definitions/Component"
                },
                "Direction": {
                    "type": "string"
                },
                "ExplanationCode": {
                    "type": "string"
                },
                "IngressRouteTable": {
                    "$ref": "#/definitions/Component"
                },
                "InternetGateway": {
                    "$ref": "#/definitions/Component"
                },
                "LoadBalancerArn": {
                    "$ref": "#/definitions/ResourceArn"
                },
                "ClassicLoadBalancerListener": {
                    "$ref": "#/definitions/LoadBalancerListener"
                },
                "LoadBalancerListenerPort": {
                    "$ref": "#/definitions/Port"
                },
                "LoadBalancerTarget": {
                    "$ref": "#/definitions/LoadBalancerTarget"
                },
                "LoadBalancerTargetGroup": {
                    "$ref": "#/definitions/Component"
                },
                "LoadBalancerTargetGroups": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Component"
                    }
                },
                "LoadBalancerTargetPort": {
                    "$ref": "#/definitions/Port"
                },
                "ElasticLoadBalancerListener": {
                    "$ref": "#/definitions/Component"
                },
                "MissingComponent": {
                    "type": "string"
                },
                "NatGateway": {
                    "$ref": "#/definitions/Component"
                },
                "NetworkInterface": {
                    "$ref": "#/definitions/Component"
                },
                "PacketField": {
                    "type": "string"
                },
                "VpcPeeringConnection": {
                    "$ref": "#/definitions/Component"
                },
                "Port": {
                    "$ref": "#/definitions/Port"
                },
                "PortRanges": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PortRange"
                    }
                },
                "PrefixList": {
                    "$ref": "#/definitions/Component"
                },
                "Protocols": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Protocol"
                    }
                },
                "RouteTableRoute": {
                    "$ref": "#/definitions/RouteTableRoute"
                },
                "RouteTable": {
                    "$ref": "#/definitions/Component"
                },
                "SecurityGroup": {
                    "$ref": "#/definitions/Component"
                },
                "SecurityGroupRule": {
                    "$ref": "#/definitions/SecurityGroupRule"
                },
                "SecurityGroups": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Component"
                    }
                },
                "SourceVpc": {
                    "$ref": "#/definitions/Component"
                },
                "State": {
                    "type": "string"
                },
                "Subnet": {
                    "$ref": "#/definitions/Component"
                },
                "SubnetRouteTable": {
                    "$ref": "#/definitions/Component"
                },
                "Vpc": {
                    "$ref": "#/definitions/Component"
                },
                "vpcEndpoint": {
                    "$ref": "#/definitions/Component"
                },
                "VpnConnection": {
                    "$ref": "#/definitions/Component"
                },
                "VpnGateway": {
                    "$ref": "#/definitions/Component"
                }
            }
        },
        "AlternatePathHint": {
            "type": "object",
            "properties": {
                "ComponentId": {
                    "type": "string"
                },
                "ComponentArn": {
                    "type": "string"
                }
            }
        }
    },
    "properties": {
        "NetworkInsightsAnalysisId": {
            "type": "string"
        },
        "NetworkInsightsAnalysisArn": {
            "type": "string"
        },
        "StartDate": {
            "type": "string"
        },
        "Status": {
            "type": "string",
            "enum": [
                "RUNNING",
                "FAILED",
                "SUCCEEDED"
            ]
        },
        "ErrorCode": {
            "type": "integer"
        },
        "ErrorMessage": {
            "type": "string"
        },
        "NetworkPathFound": {
            "type": "boolean"
        },
        "ForwardPathComponents": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/PathComponent"
            }
        },
        "ReturnPathComponents": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/PathComponent"
            }
        },
        "Explanations": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/Explanation"
            }
        },
        "AlternatePathHints": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/AlternatePathHint"
            }
        },
        "NetworkInsightsPathId": {
            "type": "string",
            "pattern": "nip-.+"
        },
        "FilterInArns": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/ResourceArn"
            }
        },
        "Tags": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/Tag"
            }
        }
    },
    "additionalProperties": false,
    "required": [
        "NetworkInsightsPathId"
    ],
    "readOnlyProperties": [
        "/properties/NetworkInsightsAnalysisId",
        "/properties/NetworkInsightsAnalysisArn",
        "/properties/StartDate",
        "/properties/Status",
        "/properties/ErrorCode",
        "/properties/ErrorMessage",
        "/properties/NetworkPathFound",
        "/properties/ForwardPathComponents",
        "/properties/ReturnPathComponents",
        "/properties/Explanations",
        "/properties/AlternatePathHints"

    ],
    "primaryIdentifier": [
        "/properties/NetworkInsightsAnalysisId"
    ],
    "createOnlyProperties": [
        "/properties/NetworkInsightsPathId",
        "/properties/FilterInArns"
    ],
    "additionalIdentifiers": [
        [
            "/properties/NetworkInsightsAnalysisArn"
        ]
    ],
    "handlers": {
        "create": {
            "permissions": [
                "ec2:StartNetworkInsightsAnalysis",
                "ec2:GetTransitGatewayRouteTablePropagations",
                "ec2:DescribeTransitGatewayPeeringAttachments",
                "ec2:SearchTransitGatewayRoutes",
                "ec2:DescribeTransitGatewayRouteTables",
                "ec2:DescribeTransitGatewayVpcAttachments",
                "ec2:DescribeTransitGatewayAttachments",
                "ec2:DescribeTransitGateways",
                "ec2:GetManagedPrefixListEntries",
                "ec2:DescribeManagedPrefixLists",
                "ec2:DescribeAvailabilityZones",
                "ec2:DescribeCustomerGateways",
                "ec2:DescribeInstances",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeNatGateways",
                "ec2:DescribeNetworkAcls",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DescribePrefixLists",
                "ec2:DescribeRegions",
                "ec2:DescribeRouteTables",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeSubnets",
                "ec2:DescribeVpcEndpoints",
                "ec2:DescribeVpcPeeringConnections",
                "ec2:DescribeVpcs",
                "ec2:DescribeVpnConnections",
                "ec2:DescribeVpnGateways",
                "ec2:DescribeVpcEndpointServiceConfigurations",
                "elasticloadbalancing:DescribeListeners",
                "elasticloadbalancing:DescribeLoadBalancers",
                "elasticloadbalancing:DescribeLoadBalancerAttributes",
                "elasticloadbalancing:DescribeRules",
                "elasticloadbalancing:DescribeTags",
                "elasticloadbalancing:DescribeTargetGroups",
                "elasticloadbalancing:DescribeTargetHealth",
                "directconnect:DescribeConnections",
                "directconnect:DescribeDirectConnectGateways",
                "directconnect:DescribeDirectConnectGatewayAssociations",
                "directconnect:DescribeDirectConnectGatewayAttachments",
                "directconnect:DescribeVirtualGateways",
                "directconnect:DescribeVirtualInterfaces",
                "tiros:CreateQuery",
                "tiros:GetQueryAnswer",
                "tiros:GetQueryExplanation"
            ]
        },
        "delete": {
            "permissions": [
                "ec2:DeleteNetworkInsightsAnalysis"
            ]
        },
        "read": {
            "permissions": [
                "ec2:DescribeNetworkInsightsAnalyses"
            ]
        },
        "list": {
            "permissions": [
                "ec2:DescribeNetworkInsightsAnalyses"
            ]
        },
        "update": {
            "permissions": [
                "ec2:CreateTags",
                "ec2:DescribeNetworkInsightsAnalyses",
                "ec2:DeleteTags"
            ]
        }
    }
}